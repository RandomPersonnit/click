import asyncio
import random

from hikkatl import types
from telethon import functions, events

from .. import loader, utils


@loader.tds
class ClickOnModule(loader.Module):
    """–ú–æ–¥—É–ª—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–ª–∏–∫–∞ –Ω–∞ –±–æ—Ç–µ"""

    strings = {"name": "ClickOn"}

    def __init__(self):
        self.running_click = False
        self.success_on_message = "<b>üëÜ –ö–ª–∏–∫ –≤–∫–ª—é—á–µ–Ω<b>"
        self.already_running_message = "‚ùåÔ∏è–ö–ª–∏–∫ —É–∂–µ –≤–∫–ª—é—á–µ–Ω"
        self.success_off_message = "<b>üëá –ö–ª–∏–∫ –≤—ã–∫–ª—é—á–µ–Ω<b>"
        self.not_running_message = "‚ùåÔ∏è–ö–ª–∏–∫ —É–∂–µ –≤—ã–∫–ª—é—á–µ–Ω"

    @loader.unrestricted
    async def clickoncmd(self, message: types.Message):
        """–í–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–ª–∏–∫"""
        if self.running_click:
            await utils.answer(message, self.already_running_message)
            return
        self.running_click = True

        await utils.answer(message, self.success_on_message)

        while self.running_click:
            await message.client(functions.messages.SendMessageRequest(
                peer='@LunarCoinbot',
                message='üåô –ö–ª–∏–∫'
            ))
            await asyncio.sleep(0.5)

    @loader.unrestricted
    async def clickoffcmd(self, message: types.Message):
        """–í—ã–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–ª–∏–∫"""
        if not self.running_click:
            await utils.answer(message, self.not_running_message)
            return
        self.running_click = False
        await utils.answer(message, self.success_off_message)
